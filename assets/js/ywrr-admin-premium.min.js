var array_unique_noempty,element_box;jQuery(function(e){e("body").on("click","button.do-send-email",function(){if(window.confirm(ywrr_admin.do_send_email)){var s={},r=e(this).parent().parent(),a=r.find(".ywrr-send-title"),n=r.find(".ywrr-send-date"),i=r.find(".ywrr-send-result"),t=ywrr_admin.is_order_page?e(this).parent().find(".ywrr-order-id").val():ywrr_admin.post_id,d=ywrr_admin.is_order_page?e(this).parent().find(".ywrr-order-date").val():ywrr_admin.order_date;i.show(),i.removeClass("send-fail send-success"),i.addClass("send-progress"),i.html(ywrr_admin.please_wait),e("#order_line_items tr").each(function(r,a){(e(this).find("input[type=checkbox]").attr("checked")||e(this).hasClass("selected"))&&(s[e(this).data("order_item_id")]=e(this).data("order_item_id"))});var c={action:"ywrr_send_request_mail",order_id:t,order_date:d,items_to_review:JSON.stringify(s,null,"")};e.post(ywrr_admin.ajax_url,c,function(e){i.removeClass("send-progress"),!0===e?(i.addClass("send-success"),i.html(ywrr_admin.after_send_email),n.html(""),a.hide()):(i.addClass("send-fail"),i.html(e.error)),setTimeout(function(){i.fadeOut("fast")},1500)})}return!1}).on("click","button.do-reschedule-email",function(s){if(window.confirm(ywrr_admin.do_reschedule_email)){var r={},a=e(this).parent().parent(),n=a.find(".ywrr-send-result"),i=a.find(".ywrr-send-date"),t=a.find(".ywrr-send-title"),d=ywrr_admin.is_order_page?e(this).parent().find(".ywrr-order-id").val():ywrr_admin.post_id;n.show(),n.removeClass("send-fail send-success"),n.addClass("send-progress"),n.html(ywrr_admin.please_wait),e("#order_line_items tr").each(function(s,a){(e(this).find("input[type=checkbox]").attr("checked")||e(this).hasClass("selected"))&&(r[e(this).data("order_item_id")]=e(this).data("order_item_id"))});var c={action:"ywrr_reschedule_mail",order_id:d,items_to_review:JSON.stringify(r,null,"")};e.post(ywrr_admin.ajax_url,c,function(e){n.removeClass("send-progress"),!0===e.success?(n.addClass("send-success"),n.html(ywrr_admin.after_reschedule_email),i.html(e.schedule),t.show()):(n.addClass("send-fail"),n.html(e.error),i.html(""),t.hide()),setTimeout(function(){n.fadeOut("fast")},1500)})}return!1}).on("click","button.do-cancel-email",function(){if(window.confirm(ywrr_admin.do_cancel_email)){var s=e(this).parent().parent(),r=s.find(".ywrr-send-result"),a=s.find(".ywrr-send-date"),n=s.find(".ywrr-send-title"),i=ywrr_admin.is_order_page?e(this).parent().find(".ywrr-order-id").val():ywrr_admin.post_id;r.show(),r.removeClass("send-fail send-success"),r.addClass("send-progress"),r.html(ywrr_admin.please_wait);var t={action:"ywrr_cancel_mail",order_id:i};e.post(ywrr_admin.ajax_url,t,function(e){r.removeClass("send-progress"),!0===e?(r.addClass("send-success"),r.html(ywrr_admin.after_cancel_email)):"notfound"===e?(r.addClass("send-fail"),r.html(ywrr_admin.not_found_cancel)):(r.addClass("send-fail"),r.html(e.error)),a.html(""),n.hide(),setTimeout(function(){r.fadeOut("fast")},1500)})}return!1}).on("click","button.ywrr-schedule-email",function(){var s=e(this).next();s.show(),s.removeClass("send-progress send-fail send-success");s.addClass("send-progress"),s.html(ywrr_admin.please_wait),e.post(ywrr_admin.ajax_url,{action:"ywrr_mass_schedule"},function(e){s.removeClass("send-progress"),!0===e.success?(s.addClass("send-success"),s.html(e.message)):(s.addClass("send-fail"),s.html(e.error))})}).on("click","button.ywrr-unschedule-email",function(){var s=e(this).next();s.show(),s.removeClass("send-progress send-fail send-success");s.addClass("send-progress"),s.html(ywrr_admin.please_wait),e.post(ywrr_admin.ajax_url,{action:"ywrr_mass_unschedule"},function(e){s.removeClass("send-progress"),!0===e.success?(s.addClass("send-success"),s.html(e.message)):(s.addClass("send-fail"),s.html(e.error))})}).on("click","button.ywrr-clear-sent-email",function(){var s=e(this).next();s.show(),s.removeClass("send-progress send-fail send-success");s.addClass("send-progress"),s.html(ywrr_admin.please_wait),e.post(ywrr_admin.ajax_url,{action:"ywrr_clear_sent"},function(e){s.removeClass("send-progress"),!0===e.success?(s.addClass("send-success"),s.html(e.message)):(s.addClass("send-fail"),s.html(e.error))})}).on("click","button.ywrr-clear-cancelled-email",function(){var s=e(this).next();s.show(),s.removeClass("send-progress send-fail send-success");s.addClass("send-progress"),s.html(ywrr_admin.please_wait),e.post(ywrr_admin.ajax_url,{action:"ywrr_clear_cancelled"},function(e){s.removeClass("send-progress"),!0===e.success?(s.addClass("send-success"),s.html(e.message)):(s.addClass("send-fail"),s.html(e.error))})}),e(document).ready(function(e){e("select#ywrr_request_type").change(function(){var s=e(this).parent().parent().nextAll("*:lt(2)");switch(e("option:selected",this).val()){case"selection":s.show();break;default:s.hide()}}).change(),e("select#ywrr_mail_item_link").change(function(){var s=e("option:selected",this).val(),r=e("#ywrr_mail_item_link_hash").parent().parent();switch(s){case"custom":r.show();break;default:r.hide()}}).change(),e("#ywrr_mail_template_enable").change(function(){e(this).is(":checked")?e("#ywrr_mail_template").val("base").prop("disabled",!0):e("#ywrr_mail_template").prop("disabled",!1)}).change(),e("#ywrr_enable_analytics").change(function(){var s=e(this).parent().parent().parent().parent().nextAll("*:lt(5)");e(this).is(":checked")?(s.show(),e("#ywrr_campaign_source").prop("required",!0),e("#ywrr_campaign_medium").prop("required",!0),e("#ywrr_campaign_name").prop("required",!0)):(s.hide(),e("#ywrr_campaign_source").prop("required",!1),e("#ywrr_campaign_medium").prop("required",!1),e("#ywrr_campaign_name").prop("required",!1))}).change(),e("#ywrr_mail_reschedule").change(function(){var s=e(this).parent().parent().nextAll("*:lt(1)");e(this).is(":checked")?s.show():s.hide()}).change(),element_box.init()}),array_unique_noempty=function(s){var r=[];return e.each(s,function(s,a){(a=e.trim(a))&&-1===e.inArray(a,r)&&r.push(a)}),r},element_box={clean:function(e){return e=e.replace(/\s*,\s*/g,",").replace(/,+/g,",").replace(/[,\s]+$/,"").replace(/^[,\s]+/,"")},parseTags:function(s){var r=s.id.split("-check-num-")[1],a=e(s).closest(".ywcc-checklist-div"),n=a.find(".ywcc-values"),i=n.val().split(","),t=[];return delete i[r],e.each(i,function(s,r){(r=e.trim(r))&&t.push(r)}),n.val(this.clean(t.join(","))),this.quickClicks(a),!1},quickClicks:function(s){var r,a=e(".ywcc-values",s),n=e(".ywcc-value-list ul",s),i=e(s).attr("id");a.length&&(r=a.val().split(","),n.empty(),e.each(r,function(s,r){var a,t;(r=e.trim(r))&&(a=e('<li class="select2-search-choice" />'),(t=e('<a id="'+i+"-check-num-"+s+'" class="select2-search-choice-close" tabindex="0"></a>')).on("click keypress",function(s){"click"!==s.type&&13!==s.keyCode||(13===s.keyCode&&e(this).closest(".ywcc-checklist-div").find("input.ywcc-insert").focus(),element_box.parseTags(this))}),a.prepend('<div><div class="selected-option" data-id="'+r+'">'+r+"</div></div>").prepend(t),n.append(a))}))},flushTags:function(s,r,a){var n,i,t,d=e(".ywcc-values",s),c=e("input.ywcc-insert",s);return void 0!==(t=(r=r||!1)?e(r).text():c.val())&&(i=(n=d.val())?n+","+t:t,i=this.clean(i),i=array_unique_noempty(i.split(",")).join(","),d.val(i),this.quickClicks(s),r||c.val(""),void 0===a&&c.focus(),!1)},init:function(){var s=e(".ywcc-checklist-ajax");e(".ywcc-checklist-div").each(function(){element_box.quickClicks(this)}),e("input.ywcc-insert",s).keyup(function(s){if(13==s.which)return element_box.flushTags(e(this).closest(".ywcc-checklist-div")),!1}).keypress(function(e){if(13==e.which)return e.preventDefault(),!1})}}});